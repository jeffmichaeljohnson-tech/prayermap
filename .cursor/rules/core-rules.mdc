---
description: Core rules that override all other considerations - verification, Living Map, JJ standards
globs: ["**/*"]
alwaysApply: true
---

# Core Rules - The Non-Negotiables

## 1. VERIFICATION ENFORCEMENT (PRINCIPLE 0)

**A fix is NOT a fix until verified working by a human.**

### The Three States

| State | Meaning | Allowed Phrases |
|-------|---------|-----------------|
| WRITTEN | Code exists | "Changes written. NOT tested." |
| TESTED | Compiles, tests pass | "Tests pass. Awaiting deployment." |
| DEPLOYED | Live on Vercel | "Deployed. Please verify at [URL]." |

### Forbidden Phrases (Before Human Verification)

- "This is fixed"
- "This should now work"
- "The bug is resolved"
- "Complete" or "Done"

### Required Verification Checklist

```markdown
## Verification
- [ ] Files exist (ls proof)
- [ ] TypeScript compiles (npx tsc --noEmit)
- [ ] Build succeeds (npm run build)
- [ ] Tests pass (npm run test)
- [ ] NOT VERIFIED: Browser functionality
- [ ] NOT VERIFIED: Mobile responsiveness
Status:  ➡️  [progress note]
```

---

## 2. DATABASE-FIRST DEBUGGING (PRINCIPLE 0.1)

**When something silently fails, check the database FIRST.**

### Debugging Hierarchy

1. Check database schema: `SELECT column_name FROM information_schema.columns WHERE table_name = 'xxx'`
2. Check browser console for Supabase errors
3. Check Supabase logs (Dashboard → Logs)
4. Test operation in SQL directly
5. THEN read the code

**TypeScript interfaces can LIE. Database columns NEVER lie.**

---

## 3. THE LIVING MAP PRINCIPLE (ABSOLUTE PRIORITY)

**If ANY technical decision conflicts with the Living Map, THE LIVING MAP WINS.**

| Requirement | Target | Non-Negotiable |
|-------------|--------|----------------|
| Real-time updates | < 2 seconds | Users SEE prayer happen |
| Memorial lines | 1 YEAR | Configurable duration, soft-delete on expiry |
| Universal map | Same for all | Shared spiritual space |
| Animations | 60fps | Spiritual beauty |

---

## 4. THE  ➡️  SYMBOL

**NEVER use green checkmarks (). Nothing is ever "done."**

- Use ` ➡️ ` for progress
- Every task reveals the next improvement
- The work continues, growth follows

---

## 5. PROVE EVERY CLAIM

```bash
# Claim: "I created the file"
# Proof required:
ls -la path/to/file
cat path/to/file | head -20

# Claim: "This works"
# Proof required:
npm run build  # Show output
npm run test   # Show results
```

---

## 6. ASK BEFORE BUILDING

Before writing code:
- Is this the simplest solution?
- Do we actually need this?
- What would break this?
- What already exists?

**Three similar lines > premature abstraction**

---

## 7. VERCEL DEPLOYMENT RULE (DEVELOPMENT-FIRST)

**ALWAYS deploy to the `develop` branch (Vercel development environment) by default.**

### Deployment Workflow

```bash
# 1. Commit changes on develop branch
git add . && git commit -m "feat: description"

# 2. Push to develop (triggers Vercel development deployment)
git push origin develop

# 3. STOP HERE - await human verification on development URL
# DO NOT merge to main unless explicitly requested
```

### Branch → Environment Mapping

| Branch | Vercel Environment | URL | When to Use |
|--------|-------------------|-----|-------------|
| `develop` | Development/Preview | develop-prayermap.vercel.app | **DEFAULT** - All changes |
| `main` | Production | prayermap.net | **ONLY when user explicitly requests** |

### Rules

1. **DEFAULT**: Push to `develop` branch only
2. **NEVER** merge to `main` or push to production unless user explicitly says:
   - "Deploy to production"
   - "Push to main"
   - "Go live"
3. **ALWAYS** confirm with user before any production deployment
4. After pushing to develop, tell user: "Deployed to development. Verify at [dev URL]"

### Forbidden Actions (Without Explicit Permission)

- ❌ `git checkout main && git merge develop`
- ❌ `git push origin main`
- ❌ Any action that deploys to production

### Required Confirmation for Production

```
User: "Deploy to production" or "Push to main"
Agent: "Confirmed. Merging to main and deploying to production..."
```
